<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cocoa App ‚Äî Juego</title>

  <!-- Tipograf√≠a -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
      color: #000;
    }

    /* HEADER */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: #046635;
      color: #fff;
      font-weight: 600;
    }
    .logo {
      font-size: 26px;
      font-weight: 800;
    }
    nav a {
      color: #fff;
      margin: 0 10px;
      text-decoration: none;
      font-weight: 600;
      padding: 6px 10px;
      border-radius: 6px;
      transition: 0.3s;
    }
    nav a:hover,
    nav a.active {
      background: #ff000f;
    }

    /* MAIN */
    main {
      text-align: center;
      padding: 30px 20px;
    }

    h1 {
      font-size: 42px;
      font-weight: 800;
      color: #ff000f;
      margin-bottom: 10px;
    }

    .info {
      font-size: 18px;
      color: #046635;
      font-weight: 600;
    }

    /* CANVAS */
    #gameCanvas {
      background: #110000;
      border: 4px solid #ff000f;
      border-radius: 18px;
      display: block;
      margin: 25px auto;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    /* CONTROLES */
    .controls {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .controls button {
      padding: 14px 20px;
      border-radius: 12px;
      border: 3px solid #046635;
      background: #ff000f;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.25s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .controls button:hover {
      background: #c8000c;
      transform: scale(1.07);
    }

    /* PUNTAJE */
    #scoreText {
      margin-top: 12px;
      font-size: 22px;
      font-weight: 700;
      color: #046635;
    }

    /* FOOTER */
    footer {
      text-align: center;
      padding: 20px;
      margin-top: 40px;
      font-weight: 700;
      background: #ff000f;
      color: #fff;
    }
  </style>
</head>

<body>

  <header>
    <div class="logo">Cocoa App</div>
    <nav>
      <a href="inicio.html">Inicio</a>
      <a href="redes.html">Redes</a>
      <a href="bandeja.html">Bandeja</a>
      <a href="juego.html" class="active">Juego</a>
      <a href="tienda.html">Tienda</a>
    </nav>
  </header>

  <main>
    <h1>Juego: Esquiva los chocolates</h1>
    <p class="info">Usa las flechas o los botones. Si te cae un chocolate: <strong>pierdes</strong>.</p>

    <canvas id="gameCanvas" width="480" height="320"></canvas>

    <div class="controls">
      <button id="leftBtn">‚óÄÔ∏è Izquierda</button>
      <button id="startBtn">‚ñ∂Ô∏è Iniciar</button>
      <button id="rightBtn">Derecha ‚ñ∂Ô∏è</button>
      <button id="restartBtn" style="display:none;">üîÑ Reiniciar</button>
    </div>

    <p id="scoreText">Puntaje: 0 | Mejor: 0</p>
  </main>

  <footer>¬© DULCE ELITE</footer>

  <!-- SCRIPT ORIGINAL DEL JUEGO (NO MODIFICADO) -->
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let player = {x:220, y:280, w:36, h:12, speed:6};
    let obstacles = [];
    let score = 0;
    let best = parseInt(localStorage.getItem('choco_best_v2')||'0',10);
    let running = false;
    let spawnTimer = 0;
    let gameLoopId = null;

    const restartBtn = document.getElementById('restartBtn');

    function resetGame(){
      obstacles = [];
      score = 0;
      player.x = (canvas.width - player.w)/2;
      running = false;
      spawnTimer = 0;
      updateScoreText();
      draw();
      restartBtn.style.display = 'none';
    }

    function startGame(){
      if(running) return;
      running = true;
      spawnTimer = 0;
      gameLoop();
    }

    function endGame(){
      running = false;
      cancelAnimationFrame(gameLoopId);
      if(score > best){ best = score; localStorage.setItem('choco_best_v2', best) }
      updateScoreText();
      restartBtn.style.display = 'inline-block';
    }

    function gameLoop(){
      if(!running) return;
      update();
      draw();
      gameLoopId = requestAnimationFrame(gameLoop);
    }

    function update(){
      spawnTimer++;
      const spawnRate = Math.max(30, 90 - Math.floor(score/5));
      if(spawnTimer >= spawnRate){
        spawnTimer = 0;
        spawnChocolate();
      }

      for(let i=obstacles.length-1;i>=0;i--){
        obstacles[i].y += obstacles[i].vy;
        if(obstacles[i].y>canvas.height+20) obstacles.splice(i,1);
        else if(rectIntersect(player, obstacles[i])){
          endGame();
          setTimeout(()=>{ alert('¬°Perdiste! Puntaje: ' + score); },50);
          return;
        }
      }
      score++;
      updateScoreText();
    }

    function spawnChocolate(){
      const size = 18 + Math.random()*12;
      const x = Math.random()*(canvas.width - size);
      const vy = 1.4 + Math.random()*1.8 + Math.min(score/200, 2);
      obstacles.push({x, y:-size, w:size, h:size, vy});
    }

    function rectIntersect(a,b){
      return !(b.x > a.x + a.w || b.x + b.w < a.x || b.y > a.y + a.h || b.y + b.h < a.y);
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#f5f5f5';
      ctx.fillRect(player.x, player.y, player.w, player.h);
      ctx.fillStyle = '#ff4d4d';
      obstacles.forEach(o => {
        ctx.fillRect(o.x, o.y, o.w, o.h);
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.fillRect(o.x + o.w*0.15, o.y + o.h*0.15, o.w*0.2, o.h*0.2);
        ctx.fillStyle = '#ff4d4d';
      });
    }

    function updateScoreText(){
      document.getElementById('scoreText').innerText = `Puntaje: ${score} | Mejor: ${best}`;
    }

    document.getElementById('startBtn').addEventListener('click',()=>{ startGame(); });
    document.getElementById('restartBtn').addEventListener('click',()=>{ resetGame(); startGame(); });

    let moveInterval = null;
    document.getElementById('leftBtn').addEventListener('mousedown', ()=>{ moveLeftStart(); });
    document.getElementById('rightBtn').addEventListener('mousedown', ()=>{ moveRightStart(); });
    document.getElementById('leftBtn').addEventListener('mouseup', stopMove);
    document.getElementById('rightBtn').addEventListener('mouseup', stopMove);

    function moveLeftStart(){ stopMove(); moveInterval=setInterval(()=>{ player.x=Math.max(0,player.x-player.speed); },16); }
    function moveRightStart(){ stopMove(); moveInterval=setInterval(()=>{ player.x=Math.min(canvas.width-player.w,player.x+player.speed); },16); }
    function stopMove(){ if(moveInterval){ clearInterval(moveInterval); moveInterval=null; } }

    window.addEventListener('keydown',(e)=>{
      if(e.key==='ArrowLeft'){ player.x=Math.max(0,player.x-player.speed); draw(); }
      if(e.key==='ArrowRight'){ player.x=Math.min(canvas.width-player.w,player.x+player.speed); draw(); }
      if(e.key===' '){ startGame(); }
    });

    canvas.addEventListener('touchmove',(e)=>{
      const rect = canvas.getBoundingClientRect();
      const t = e.touches[0];
      const px = (t.clientX-rect.left)/rect.width*canvas.width;
      player.x = Math.min(canvas.width-player.w, Math.max(0, px-player.w/2));
      draw();
    });

    resetGame();
    draw();
  </script>

</body>
</html>
